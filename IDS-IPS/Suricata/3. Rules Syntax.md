When you install Suricata, it will already come with some predefined rules. To see those rules, we need to stay in the `/etc/suricata/` directory and move to the rules directory, with the following command `cd rules`. With the ls command we can see all the .rules files, which contain the different default rules.

---

# Rules format
These rules are divided into 3 parts:
The first part is *the action*. This part indicates what we will do with the packet that meets the rule that is created.  
The second is *the header*. In this part we indicate: the protocol, the source IP, the source port, the communication address, the destination IP and the destination port.  
And the last are *the rule options*. These options change depending on many aspects, such as the protocol that is going to be used.  

---

# Help for the formation of rules  

## 1. Actions
*Note*: In IPS mood, using any rejected action also enables drop
- **alert**: Generates an alert 
- **pass**: Stop inspecting a package
- **reject**: An unreachable destination error is sent to the sender
- **rejectscr**: An unreachable destination error is sent to the sender
- **rejectdst**:A destination unreachable error is sent to the receiver
- **rejectboth**: Destination unreachable error is sent to both sides

## 2. Hearder
### Protocol
- *Bascis protocols*: tcp, udp, icmp. ip  
- *Application protocol*: http, ftp, tls, smb, dns, dcerpc, ssh, smtp, imap  

### Source and Destination
After indicating the protocol, we must indicate the source and destination IP. In this field you can indicate a single IP, a range of IPs or exclude the IPs you want. 
- *../..* : IP ranges.  
- *!*: exception/negation.  
- *[..,..]*: grouping.  

### Ports
- *any*: To specify any port  
- *Two Points (:)*: port range. Example: Range from 80 to 85 ->  **[80:85]**   
- *!*: exception/negation. Example: All ports except 50 -> **!50**  
- *[..,..]*: grouping.  

### Directions
We only have two types of addresses:    
- The first is from source to destination. To use this address, you must use the **->** symbol.  
- The second is in both directions. To use this address, you must use the **< >** symbol.

*Important: In this case, the reverse direction (Source <- Destination) does not exist.*

## 3. Rule options
This section of the rules has no fixed length; you can add as many options as you like. There are many options of this type, and they all share a common syntax: **(<keyword\>: <configuration (only if the keyword accepts configuration)\>;)**. All rule options are separated by a **;**. Words like "nocase" do not require configuration.  
*Important: These options have a specific order and changing it could modify the rule.*   

To know more about the rule options visit the web site specificated en the resources like "Rule options".

---

# Example Rules
These are 3 examples of rules you could try in this lab, but if you want to create your own rules, feel free to do so.

## Rule 1: Detect ICMP packets
```
alert icmp any any -> any any (msg:"ICMP Packet found"; sid:2000001; rev:1;)
```

## Rule 2:  SSH connection detection
```
alert tcp any any -> any 22 (msg:"SSH connection detected"; flow:to_server; app-layer-protocol:ssh; sid:2271009; rev:1;)
```

## Rule 3: Detecting suspicious DNS traffic
```
alert udp any any -> any 53 (msg:"Unusual DNS request length (possible data exfiltration)"; byte_test:40,>,200,string,content; sid:2000007; rev:1;)
```

---

# Viewing Logs
To view the logs generated by the rules, you must access the file where they are stored. This is specified in the Suricata configuration file; by default, this file is located at the following path:
```
/var/log/suricata/
```
